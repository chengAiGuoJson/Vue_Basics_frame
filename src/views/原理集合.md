## 浏览器输入地址按下回车后发生了什么

### 1、URL解析
1.1 浏览器首先解析输入的URL，提取协议（http/https）、域名、端口号、路径等信息
1.2 如果没有指定协议，浏览器会默认使用HTTPS
1.3 检查URL格式是否正确，进行基本的语法验证
1.4 处理相对路径和绝对路径

### 2、DNS域名解析
2.1 浏览器检查本地DNS缓存
2.2 检查操作系统DNS缓存
2.3 检查路由器DNS缓存
2.4 向本地DNS服务器查询
2.5 DNS服务器递归查询过程：
    - 根域名服务器查询
    - 顶级域名服务器查询
    - 权威域名服务器查询
2.6 返回域名对应的IP地址
2.7 缓存DNS解析结果

### 3、TCP连接建立
3.1 使用获得的IP地址向服务器发起TCP连接
3.2 三次握手建立可靠连接：
    - 客户端发送SYN包
    - 服务器回复SYN+ACK包
    - 客户端发送ACK包确认连接
3.3 连接建立成功，准备数据传输

### 4、TLS/SSL握手（HTTPS）
4.1 客户端发送Client Hello（支持的加密算法、随机数等）
4.2 服务器回复Server Hello和数字证书
4.3 客户端验证服务器证书的有效性
4.4 协商加密算法和生成会话密钥
4.5 建立安全的加密通道

### 5、发送HTTP请求
5.1 构造HTTP请求报文：
    - 请求行（方法、URL、HTTP版本）
    - 请求头（User-Agent、Accept、Cookie、Referer等）
    - 请求体（POST请求时包含数据）
5.2 通过已建立的TCP连接发送请求
5.3 可能启用HTTP/2多路复用优化

### 6、服务器处理请求
6.1 Web服务器接收并解析HTTP请求
6.2 根据请求路径查找对应的资源
6.3 检查缓存策略（ETag、Last-Modified等）
6.4 应用服务器处理动态内容（如果需要）
6.5 数据库查询和业务逻辑处理
6.6 生成HTTP响应内容

### 7、服务器返回响应
7.1 构造HTTP响应报文：
    - 状态行（HTTP版本、状态码、状态描述）
    - 响应头（Content-Type、Content-Length、Cache-Control等）
    - 响应体（HTML、CSS、JS、图片等资源）
7.2 发送响应数据到客户端

### 8、浏览器接收和预处理
8.1 浏览器接收响应数据
8.2 根据Content-Type判断资源类型
8.3 检查响应状态码，处理重定向等情况
8.4 开始流式解析HTML文档

### 9、构建DOM树（浏览器解析HTML）
9.1 词法分析：将HTML文本转换为标记（tokens）
9.2 语法分析：根据标记构建DOM节点
9.3 构建DOM树结构
9.4 处理HTML解析错误和容错机制
9.5 遇到外部资源时发起新的HTTP请求

### 10、构建CSSOM树（浏览器解析CSS）
10.1 解析CSS样式表（内联、内部、外部）
10.2 处理CSS选择器和属性
10.3 构建CSSOM（CSS对象模型）树
10.4 处理CSS优先级和层叠规则
10.5 CSS解析可能会阻塞渲染

### 11、JavaScript处理（浏览器解析JS）
11.1 遇到<script>标签时暂停HTML解析
11.2 下载JavaScript文件（如果是外部脚本）
11.3 JavaScript引擎解析和编译：
    - 词法分析（Lexical Analysis）
    - 语法分析（Syntax Analysis）
    - 生成抽象语法树（AST）
    - 字节码生成
    - JIT编译优化
11.4 执行JavaScript代码
11.5 可能修改DOM和CSSOM

### 12、渲染树构建和布局
12.1 将DOM树和CSSOM树合并生成渲染树
12.2 渲染树只包含需要显示的节点
12.3 布局（Layout/Reflow）计算：
    - 计算每个节点的确切位置
    - 计算每个节点的大小
    - 处理文档流、浮动、定位等

### 13、绘制和合成（浏览器渲染页面）
13.1 绘制（Paint）阶段：
    - 将渲染树转换为屏幕像素
    - 处理颜色、阴影、边框等视觉效果
13.2 分层处理：
    - 创建图层（Layer）
    - 处理z-index、transform、opacity等
13.3 合成（Composite）阶段：
    - GPU加速处理
    - 将各个图层合成最终页面

### 14、资源加载和优化
14.1 异步加载剩余资源（图片、字体等）
14.2 懒加载处理
14.3 缓存策略应用
14.4 预加载和预连接优化

### 15、交互就绪
15.1 所有关键资源加载完毕
15.2 触发DOMContentLoaded事件
15.3 触发load事件
15.4 页面完全可交互
15.5 持续的JavaScript执行和DOM更新

### 性能优化关键点
- **关键渲染路径优化**：优先加载首屏内容
- **资源压缩和缓存**：减少传输时间
- **CDN加速**：就近获取资源
- **HTTP/2优化**：多路复用减少连接开销
- **代码分割**：按需加载减少初始包大小
- **图片优化**：格式选择和懒加载
- **DNS预解析**：提前解析域名
- **预连接和预加载**：提前建立连接

## 短连接 vs 长连接

### HTTP短连接（HTTP/1.0默认）
- **特点**：每次HTTP请求都需要建立新的TCP连接
- **流程**：建立连接 → 发送请求 → 接收响应 → 关闭连接
- **优点**：服务器资源占用少，连接管理简单
- **缺点**：频繁建立/断开连接，性能开销大
- **适用场景**：请求频率低的应用

### HTTP长连接（HTTP/1.1默认）
- **特点**：复用TCP连接，Connection: keep-alive
- **流程**：建立连接 → 多次请求/响应 → 超时或主动关闭
- **优点**：减少连接建立开销，提高性能
- **缺点**：服务器需要维护连接状态
- **配置参数**：
  - Keep-Alive timeout：连接保持时间
  - Keep-Alive max：最大请求次数

### WebSocket长连接
- **特点**：全双工通信，持久连接
- **握手过程**：HTTP升级协议握手
- **优点**：实时通信，低延迟
- **适用场景**：聊天应用、实时游戏、股票行情



