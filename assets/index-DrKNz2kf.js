var R=Object.defineProperty;var Y=(o,t,e)=>t in o?R(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var y=(o,t,e)=>Y(o,typeof t!="symbol"?t+"":t,e);import{p as U,r as D,B as f,o as M,R as G,d as H,c as _,a as p,b as s,q as V,z as u,t as h,F as B,f as z,_ as K}from"./index-Ch7JS-cg.js";class L{constructor(t,e,r,d="",v="",w=""){y(this,"id");y(this,"name");y(this,"price");y(this,"image");y(this,"description");y(this,"category");if(r<0)throw new Error("å•†å“ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°");if(!e.trim())throw new Error("å•†å“åç§°ä¸èƒ½ä¸ºç©º");this.id=t,this.name=e.trim(),this.price=r,this.image=d,this.description=v,this.category=w}getFormattedPrice(){return`Â¥${this.price.toFixed(2)}`}isValid(){return this.id.length>0&&this.name.length>0&&this.price>=0}getSummary(){return`${this.name} - ${this.getFormattedPrice()}`}toJSON(){return{id:this.id,name:this.name,price:this.price,image:this.image,description:this.description,category:this.category}}static fromJSON(t){return new L(t.id,t.name,t.price,t.image||"",t.description||"",t.category||"")}}class b{constructor(t,e=1){y(this,"_product");y(this,"_quantity");if(e<=0)throw new Error("å•†å“æ•°é‡å¿…é¡»å¤§äº0");if(!t||!t.isValid())throw new Error("æ— æ•ˆçš„å•†å“ä¿¡æ¯");this._product=t,this._quantity=e}get product(){return this._product}get quantity(){return this._quantity}set quantity(t){if(t<=0)throw new Error("å•†å“æ•°é‡å¿…é¡»å¤§äº0");this._quantity=t}get productId(){return this._product.id}get productName(){return this._product.name}get unitPrice(){return this._product.price}getSubtotal(){return this._product.price*this._quantity}getFormattedSubtotal(){return`Â¥${this.getSubtotal().toFixed(2)}`}increaseQuantity(t=1){if(t<=0)throw new Error("å¢åŠ æ•°é‡å¿…é¡»å¤§äº0");this._quantity+=t}decreaseQuantity(t=1){if(t<=0)throw new Error("å‡å°‘æ•°é‡å¿…é¡»å¤§äº0");if(this._quantity-t<=0)throw new Error("æ•°é‡ä¸èƒ½å‡å°‘åˆ°0æˆ–è´Ÿæ•°");this._quantity-=t}updateQuantity(t){if(t<=0)throw new Error("å•†å“æ•°é‡å¿…é¡»å¤§äº0");this._quantity=t}isSameProduct(t){return this._product.id===t.id}clone(){return new b(this._product,this._quantity)}toJSON(){return{product:this._product.toJSON(),quantity:this._quantity,subtotal:this.getSubtotal()}}static fromJSON(t){const e=L.fromJSON(t.product);return new b(e,t.quantity)}getDescription(){return`${this._product.name} x ${this._quantity} = ${this.getFormattedSubtotal()}`}}class E{constructor(){y(this,"_items",new Map);y(this,"_listeners",[]);this._items=new Map,this._listeners=[]}get items(){return Array.from(this._items.values())}get itemCount(){return this._items.size}get totalQuantity(){return this.items.reduce((t,e)=>t+e.quantity,0)}get isEmpty(){return this._items.size===0}addProduct(t,e=1){if(!t||!t.isValid())throw new Error("æ— æ•ˆçš„å•†å“ä¿¡æ¯");if(e<=0)throw new Error("å•†å“æ•°é‡å¿…é¡»å¤§äº0");const r=this._items.get(t.id);if(r)r.increaseQuantity(e),this._notifyListeners({type:"update",item:r,quantity:r.quantity});else{const d=new b(t,e);this._items.set(t.id,d),this._notifyListeners({type:"add",item:d})}}removeProduct(t){const e=this._items.get(t);return e?(this._items.delete(t),this._notifyListeners({type:"remove",productId:t,item:e}),!0):!1}updateQuantity(t,e){if(e<=0)throw new Error("å•†å“æ•°é‡å¿…é¡»å¤§äº0");const r=this._items.get(t);return r?(r.quantity,r.updateQuantity(e),this._notifyListeners({type:"update",item:r,quantity:e}),!0):!1}increaseQuantity(t,e=1){const r=this._items.get(t);return r?(r.increaseQuantity(e),this._notifyListeners({type:"update",item:r,quantity:r.quantity}),!0):!1}decreaseQuantity(t,e=1){const r=this._items.get(t);if(r)try{return r.decreaseQuantity(e),this._notifyListeners({type:"update",item:r,quantity:r.quantity}),!0}catch{return this.removeProduct(t),!0}return!1}getItem(t){return this._items.get(t)}hasProduct(t){return this._items.has(t)}getProductQuantity(t){const e=this._items.get(t);return e?e.quantity:0}getTotalAmount(){return this.items.reduce((t,e)=>t+e.getSubtotal(),0)}getFormattedTotalAmount(){return`Â¥${this.getTotalAmount().toFixed(2)}`}clear(){this._items.clear(),this._notifyListeners({type:"clear"})}getSummary(){return this.isEmpty?"è´­ç‰©è½¦ä¸ºç©º":`å…± ${this.itemCount} ç§å•†å“ï¼Œ${this.totalQuantity} ä»¶ï¼Œæ€»è®¡ ${this.getFormattedTotalAmount()}`}addEventListener(t){this._listeners.push(t)}removeEventListener(t){const e=this._listeners.indexOf(t);e>-1&&this._listeners.splice(e,1)}_notifyListeners(t){this._listeners.forEach(e=>{try{e(t)}catch(r){console.error("è´­ç‰©è½¦äº‹ä»¶ç›‘å¬å™¨æ‰§è¡Œé”™è¯¯:",r)}})}toJSON(){return{items:this.items.map(t=>t.toJSON()),totalAmount:this.getTotalAmount(),totalQuantity:this.totalQuantity,itemCount:this.itemCount}}static fromJSON(t){const e=new E;return t.items&&Array.isArray(t.items)&&t.items.forEach(r=>{try{const d=b.fromJSON(r);e._items.set(d.productId,d)}catch(d){console.error("æ¢å¤è´­ç‰©è½¦é¡¹å¤±è´¥:",d)}}),e}clone(){const t=new E;return this.items.forEach(e=>{t._items.set(e.productId,e.clone())}),t}merge(t){t.items.forEach(e=>{this.addProduct(e.product,e.quantity)})}}function W(){const o=U(new E),t=D(!1),e=D(null),r=f(()=>o.items),d=f(()=>o.getTotalAmount()),v=f(()=>o.getFormattedTotalAmount()),w=f(()=>o.totalQuantity),g=f(()=>o.itemCount),S=f(()=>o.isEmpty),N=f(()=>o.getSummary()),Q=i=>{console.log("è´­ç‰©è½¦äº‹ä»¶:",i),C()},F=async(i,l=1)=>{try{t.value=!0,e.value=null,o.addProduct(i,l)}catch(a){throw e.value=a instanceof Error?a.message:"æ·»åŠ å•†å“å¤±è´¥",a}finally{t.value=!1}},$=async i=>{try{if(t.value=!0,e.value=null,!o.removeProduct(i))throw new Error("å•†å“ä¸å­˜åœ¨")}catch(l){throw e.value=l instanceof Error?l.message:"ç§»é™¤å•†å“å¤±è´¥",l}finally{t.value=!1}},A=async(i,l)=>{try{if(t.value=!0,e.value=null,!o.updateQuantity(i,l))throw new Error("å•†å“ä¸å­˜åœ¨")}catch(a){throw e.value=a instanceof Error?a.message:"æ›´æ–°æ•°é‡å¤±è´¥",a}finally{t.value=!1}},O=async(i,l=1)=>{try{if(t.value=!0,e.value=null,!o.increaseQuantity(i,l))throw new Error("å•†å“ä¸å­˜åœ¨")}catch(a){throw e.value=a instanceof Error?a.message:"å¢åŠ æ•°é‡å¤±è´¥",a}finally{t.value=!1}},J=async(i,l=1)=>{try{if(t.value=!0,e.value=null,!o.decreaseQuantity(i,l))throw new Error("å•†å“ä¸å­˜åœ¨")}catch(a){throw e.value=a instanceof Error?a.message:"å‡å°‘æ•°é‡å¤±è´¥",a}finally{t.value=!1}},P=async()=>{try{t.value=!0,e.value=null,o.clear()}catch(i){throw e.value=i instanceof Error?i.message:"æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥",i}finally{t.value=!1}},q=i=>o.getProductQuantity(i),x=i=>o.hasProduct(i),C=()=>{try{const i=o.toJSON();localStorage.setItem("shopping-cart",JSON.stringify(i))}catch(i){console.error("ä¿å­˜è´­ç‰©è½¦åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:",i)}},k=()=>{try{const i=localStorage.getItem("shopping-cart");if(i){const l=JSON.parse(i),a=E.fromJSON(l);o.merge(a)}}catch(i){console.error("ä»æœ¬åœ°å­˜å‚¨åŠ è½½è´­ç‰©è½¦å¤±è´¥:",i)}},I=()=>{e.value=null};return M(()=>{o.addEventListener(Q),k()}),G(()=>{o.removeEventListener(Q)}),{cart:o,cartItems:r,totalAmount:d,formattedTotalAmount:v,totalQuantity:w,itemCount:g,isEmpty:S,cartSummary:N,isLoading:t,error:e,addProduct:F,removeProduct:$,updateQuantity:A,increaseQuantity:O,decreaseQuantity:J,clearCart:P,getProductQuantity:q,hasProduct:x,clearError:I,saveToLocalStorage:C,loadFromLocalStorage:k}}const X={class:"shopping-cart-container"},Z={key:0,class:"error-message"},j={class:"products-section"},tt={class:"products-grid"},et={class:"product-image"},st=["src","alt"],rt={class:"product-info"},it={class:"product-description"},nt={class:"product-price"},ot={class:"product-actions"},at=["onClick","disabled"],ct={key:0},ut={key:1},lt={class:"cart-section"},dt={class:"cart-header"},ht={class:"cart-summary"},mt={key:0,class:"empty-cart"},yt={key:1,class:"cart-content"},_t={class:"cart-items"},pt={class:"item-image"},gt=["src","alt"],ft={class:"item-info"},vt={class:"item-price"},wt={class:"item-quantity"},bt=["onClick","disabled"],Et={class:"quantity"},St=["onClick","disabled"],Qt={class:"item-subtotal"},Pt={class:"item-actions"},qt=["onClick","disabled"],Ct={class:"cart-footer"},kt={class:"cart-total"},Lt={class:"total-info"},Nt={class:"total-amount"},Ft={class:"total-details"},$t={class:"cart-actions"},At=["disabled"],Ot=["disabled"],Jt={key:1,class:"loading-overlay"},xt=H({__name:"index",setup(o){const{cartItems:t,formattedTotalAmount:e,totalQuantity:r,itemCount:d,isEmpty:v,cartSummary:w,isLoading:g,error:S,addProduct:N,removeProduct:Q,increaseQuantity:F,decreaseQuantity:$,clearCart:A,getProductQuantity:O,hasProduct:J,clearError:P}=W(),q=D([]),x=()=>{const m=[{id:"1",name:"æ¤°äº‘æ‹¿é“",price:32,image:"â˜•",description:"1äººä»½ ã€åƒé‡Œé¦™ã€‘ä¸€å£",category:"å’–å•¡"},{id:"2",name:"ç”Ÿæ¤°æ‹¿é“",price:19.9,image:"ğŸ¥¥",description:"1äººä»½ ã€YYDSï¼Œæ— æ·»åŠ ã€‘",category:"å’–å•¡"},{id:"3",name:"åŠ æµ“ ç¾å¼",price:20.3,image:"â˜•",description:"1äººä»½ ã€æµ“éƒé¦™é†‡ï¼Œæç¥ã€‘",category:"å’–å•¡"},{id:"4",name:"ç“¦å°”ç™»è“é’»å¥¶æ˜”",price:38,image:"ğŸ¥¤",description:"1äººä»½ ã€é¢œå€¼æ‹…å½“ã€‘è“è‰²",category:"å¥¶æ˜”"},{id:"5",name:"æ¤°äº‘æ¦›æœç¾å¼",price:21.12,image:"â˜•",description:"1äººä»½ ã€åƒé‡Œé¦™ã€‘å¤§å£å–",category:"å’–å•¡"}];q.value=m.map(n=>new L(n.id,n.name,n.price,n.image,n.description,n.category))},C=async m=>{try{await N(m,1)}catch(n){console.error("æ·»åŠ å•†å“å¤±è´¥:",n)}},k=async m=>{try{await Q(m)}catch(n){console.error("ç§»é™¤å•†å“å¤±è´¥:",n)}},I=async m=>{try{await F(m,1)}catch(n){console.error("å¢åŠ æ•°é‡å¤±è´¥:",n)}},i=async m=>{try{await $(m,1)}catch(n){console.error("å‡å°‘æ•°é‡å¤±è´¥:",n)}},l=async()=>{if(confirm("ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ"))try{await A()}catch(m){console.error("æ¸…ç©ºè´­ç‰©è½¦å¤±è´¥:",m)}},a=()=>{if(v.value){alert("è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œæ— æ³•ç»“ç®—");return}alert(`ç»“ç®—æˆåŠŸï¼æ€»é‡‘é¢: ${e.value}`)};return M(()=>{x()}),(m,n)=>(p(),_("div",X,[n[6]||(n[6]=s("div",{class:"header"},[s("h1",null,"è´­ç‰©è½¦æ¼”ç¤º"),s("p",{class:"subtitle"},"åŸºäºé¢å‘å¯¹è±¡è®¾è®¡çš„è´­ç‰©è½¦åŠŸèƒ½")],-1)),u(S)?(p(),_("div",Z,[s("span",null,h(u(S)),1),s("button",{onClick:n[0]||(n[0]=(...c)=>u(P)&&u(P)(...c)),class:"close-btn"},"Ã—")])):V("",!0),s("div",j,[n[1]||(n[1]=s("h2",null,"å•†å“åˆ—è¡¨",-1)),s("div",tt,[(p(!0),_(B,null,z(q.value,c=>(p(),_("div",{key:c.id,class:"product-card"},[s("div",et,[s("img",{src:c.image,alt:c.name},null,8,st)]),s("div",rt,[s("h3",null,h(c.name),1),s("p",it,h(c.description),1),s("div",nt,h(c.getFormattedPrice()),1),s("div",ot,[s("button",{onClick:T=>C(c),disabled:u(g),class:"add-btn"},[u(J)(c.id)?(p(),_("span",ct," å·²åœ¨è´­ç‰©è½¦ ("+h(u(O)(c.id))+") ",1)):(p(),_("span",ut,"åŠ å…¥è´­ç‰©è½¦"))],8,at)])])]))),128))])]),s("div",lt,[s("div",dt,[n[2]||(n[2]=s("h2",null,"è´­ç‰©è½¦",-1)),s("div",ht,h(u(w)),1)]),u(v)?(p(),_("div",mt,[...n[3]||(n[3]=[s("div",{class:"empty-icon"},"ğŸ›’",-1),s("p",null,"è´­ç‰©è½¦æ˜¯ç©ºçš„",-1),s("p",{class:"empty-hint"},"è¯·ä»ä¸Šæ–¹å•†å“åˆ—è¡¨ä¸­æ·»åŠ å•†å“",-1)])])):(p(),_("div",yt,[s("div",_t,[(p(!0),_(B,null,z(u(t),c=>(p(),_("div",{key:c.productId,class:"cart-item"},[s("div",pt,[s("img",{src:c.product.image,alt:c.product.name},null,8,gt)]),s("div",ft,[s("h4",null,h(c.product.name),1),s("p",vt,"å•ä»·: "+h(c.product.getFormattedPrice()),1)]),s("div",wt,[s("button",{onClick:T=>i(c.productId),disabled:u(g),class:"quantity-btn"}," - ",8,bt),s("span",Et,h(c.quantity),1),s("button",{onClick:T=>I(c.productId),disabled:u(g),class:"quantity-btn"}," + ",8,St)]),s("div",Qt,h(c.getFormattedSubtotal()),1),s("div",Pt,[s("button",{onClick:T=>k(c.productId),disabled:u(g),class:"remove-btn"}," åˆ é™¤ ",8,qt)])]))),128))]),s("div",Ct,[s("div",kt,[s("div",Lt,[n[4]||(n[4]=s("span",{class:"total-label"},"æ€»è®¡:",-1)),s("span",Nt,h(u(e)),1)]),s("div",Ft," å…± "+h(u(d))+" ç§å•†å“ï¼Œ"+h(u(r))+" ä»¶ ",1)]),s("div",$t,[s("button",{onClick:l,disabled:u(g),class:"clear-btn"}," æ¸…ç©ºè´­ç‰©è½¦ ",8,At),s("button",{onClick:a,disabled:u(g),class:"checkout-btn"}," ç»“ç®— ",8,Ot)])])]))]),u(g)?(p(),_("div",Jt,[...n[5]||(n[5]=[s("div",{class:"loading-spinner"},null,-1)])])):V("",!0)]))}}),Dt=K(xt,[["__scopeId","data-v-b3383b2e"]]);export{Dt as default};
