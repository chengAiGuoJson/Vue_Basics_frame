import{Z as H,$ as Y,o as F,a0 as Z,a1 as w,a2 as L,v as _,a3 as R,a4 as J,B as j,a5 as g,x as K,z as X,d as q,r as x,a6 as ee,c as I,a as M,b as y,F as z,f as te,q as $,s as ne,_ as oe}from"./index-B688Lw4V.js";function A(e,t){return H()?(Y(e,t),!0):!1}const N=new WeakMap,ie=(...e)=>{var t;const n=e[0],s=(t=L())===null||t===void 0?void 0:t.proxy,a=s??H();if(a==null&&!R())throw new Error("injectLocal must be called in setup");return a&&N.has(a)&&n in N.get(a)?N.get(a)[n]:J(...e)},se=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const re=e=>e!=null,ae=Object.prototype.toString,le=e=>ae.call(e)==="[object Object]",W=()=>{};function ue(e,t){function n(...s){return new Promise((a,c)=>{Promise.resolve(e(()=>t.apply(this,s),{fn:t,thisArg:this,args:s})).then(a).catch(c)})}return n}function ce(e,t={}){let n,s,a=W;const c=o=>{clearTimeout(o),a(),a=W};let f;return o=>{const r=w(e),l=w(t.maxWait);return n&&c(n),r<=0||l!==void 0&&l<=0?(s&&(c(s),s=void 0),Promise.resolve(o())):new Promise((u,h)=>{a=t.rejectOnCancel?h:u,f=o,l&&!s&&(s=setTimeout(()=>{n&&c(n),s=void 0,u(f())},l)),n=setTimeout(()=>{s&&c(s),s=void 0,u(o())},r)})}}function B(e){return e.endsWith("rem")?Number.parseFloat(e)*16:Number.parseFloat(e)}function E(e){return Array.isArray(e)?e:[e]}function de(e){return L()}function fe(e,t=200,n={}){return ue(ce(t,n),e)}function ve(e,t=!0,n){de()?F(e,n):t?e():Z(e)}function he(e,t,n){return _(e,t,{...n,immediate:!0})}const C=se?window:void 0;function T(e){var t;const n=w(e);return(t=n==null?void 0:n.$el)!==null&&t!==void 0?t:n}function k(...e){const t=[],n=()=>{t.forEach(i=>i()),t.length=0},s=(i,o,r,l)=>(i.addEventListener(o,r,l),()=>i.removeEventListener(o,r,l)),a=j(()=>{const i=E(w(e[0])).filter(o=>o!=null);return i.every(o=>typeof o!="string")?i:void 0}),c=he(()=>{var i,o;return[(i=(o=a.value)===null||o===void 0?void 0:o.map(r=>T(r)))!==null&&i!==void 0?i:[C].filter(r=>r!=null),E(w(a.value?e[1]:e[0])),E(X(a.value?e[2]:e[1])),w(a.value?e[3]:e[2])]},([i,o,r,l])=>{if(n(),!(i!=null&&i.length)||!(o!=null&&o.length)||!(r!=null&&r.length))return;const u=le(l)?{...l}:l;t.push(...i.flatMap(h=>o.flatMap(d=>r.map(b=>s(h,d,b,u)))))},{flush:"post"}),f=()=>{c(),n()};return A(n),f}function pe(){const e=g(!1),t=L();return t&&F(()=>{e.value=!0},t),e}function D(e){const t=pe();return j(()=>(t.value,!!e()))}const me=Symbol("vueuse-ssr-width");function we(){const e=R()?ie(me,null):null;return typeof e=="number"?e:void 0}function ge(e,t={}){const{window:n=C,ssrWidth:s=we()}=t,a=D(()=>n&&"matchMedia"in n&&typeof n.matchMedia=="function"),c=g(typeof s=="number"),f=g(),i=g(!1),o=r=>{i.value=r.matches};return K(()=>{if(c.value){c.value=!a.value,i.value=w(e).split(",").some(r=>{const l=r.includes("not all"),u=r.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),h=r.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let d=!!(u||h);return u&&d&&(d=s>=B(u[1])),h&&d&&(d=s<=B(h[1])),l?!d:d});return}a.value&&(f.value=n.matchMedia(w(e)),i.value=f.value.matches)}),k(f,"change",o,{passive:!0}),j(()=>i.value)}function be(e,t,n={}){const{root:s,rootMargin:a="0px",threshold:c=0,window:f=C,immediate:i=!0}=n,o=D(()=>f&&"IntersectionObserver"in f),r=j(()=>E(w(e)).map(T).filter(re));let l=W;const u=g(i),h=o.value?_(()=>[r.value,T(s),u.value],([b,O])=>{if(l(),!u.value||!b.length)return;const S=new IntersectionObserver(t,{root:T(O),rootMargin:a,threshold:c});b.forEach(V=>V&&S.observe(V)),l=()=>{S.disconnect(),l=W}},{immediate:i,flush:"post"}):W,d=()=>{l(),h(),u.value=!1};return A(d),{isSupported:o,isActive:u,pause(){l(),u.value=!1},resume(){u.value=!0},stop:d}}function ye(e={}){const{window:t=C,initialWidth:n=Number.POSITIVE_INFINITY,initialHeight:s=Number.POSITIVE_INFINITY,listenOrientation:a=!0,includeScrollbar:c=!0,type:f="inner"}=e,i=g(n),o=g(s),r=()=>{if(t)if(f==="outer")i.value=t.outerWidth,o.value=t.outerHeight;else if(f==="visual"&&t.visualViewport){const{width:u,height:h,scale:d}=t.visualViewport;i.value=Math.round(u*d),o.value=Math.round(h*d)}else c?(i.value=t.innerWidth,o.value=t.innerHeight):(i.value=t.document.documentElement.clientWidth,o.value=t.document.documentElement.clientHeight)};r(),ve(r);const l={passive:!0};return k("resize",r,l),t&&f==="visual"&&t.visualViewport&&k(t.visualViewport,"resize",r,l),a&&_(ge("(orientation: portrait)"),()=>r()),{width:i,height:o}}const xe={class:"grid grid-cols-[repeat(auto-fit,minmax(400px,1fr))] gap-4"},Ie={class:"relative w-full h-full"},Me=["src","onLoad","onError"],We={key:0,class:"absolute inset-0 flex items-center justify-center placeholder"},Se={key:1,class:"absolute inset-0 flex items-center justify-center error"},P=400,Ee=q({__name:"index",setup(e){const t=x([]),n=x(null),s=x(!1),a=x({}),c=x({}),f=v=>{a.value[v]=!0,c.value[v]=!1},i=v=>{c.value[v]=!0,a.value[v]=!1},o=()=>Date.now().toString(36)+Math.random().toString(36).slice(2),r=()=>`https://picsum.photos/400/400?hash=${o()}`,l=v=>{if(!s.value){s.value=!0;for(let p=0;p<v;p++)t.value.push(r());s.value=!1}},u=()=>{const v=Math.max(1,Math.floor(window.innerWidth/P)),p=Math.max(1,Math.ceil(window.innerHeight/P));return v*p};let h=null,d=null;const{width:b,height:O}=ye(),S=()=>{const v=u();return Math.max(0,v-t.value.length)},U=fe(()=>{const v=S();v>0&&l(v)},200);return F(()=>{l(u());const{stop:v}=be(n,([p])=>{if(console.log(p),p&&p.isIntersecting){const m=Math.max(1,Math.floor(window.innerWidth/P));l(m)}});h=v,d=_([b,O],()=>{U()})}),ee(()=>{h&&h(),d&&d()}),(v,p)=>(M(),I(z,null,[y("div",xe,[(M(!0),I(z,null,te(t.value,(m,G)=>(M(),I("div",{key:G,class:"bg-[#f0f0f0] p-4 flex items-center justify-center min-w-400px min-h-400px"},[y("div",Ie,[y("img",{src:m,alt:"",class:ne(["w-full h-full object-cover transition-opacity duration-300",a.value[m]?"opacity-100":"opacity-0"]),onLoad:Q=>f(m),onError:Q=>i(m)},null,42,Me),!a.value[m]&&!c.value[m]?(M(),I("div",We,[...p[0]||(p[0]=[y("div",{class:"loader"},null,-1)])])):$("",!0),c.value[m]?(M(),I("div",Se,[...p[1]||(p[1]=[y("span",{class:"error-text"},"图片加载失败",-1)])])):$("",!0)])]))),128))]),y("div",{ref_key:"infiniteSentinel",ref:n,class:"h-1"},null,512)],64))}}),_e=oe(Ee,[["__scopeId","data-v-583ac8fc"]]);export{_e as default};
