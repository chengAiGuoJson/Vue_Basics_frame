import{Z as Y,$ as ne,o as L,a0 as oe,a1 as y,a2 as H,v as k,a3 as Q,a4 as se,B as T,a5 as b,x as ie,z as re,d as le,r as w,a6 as ae,c as W,a as I,b as g,q as z,F as A,f as ue,n as V,G as ce,s as de,_ as fe}from"./index-nxSPgvv3.js";function Z(e,t){return Y()?(ne(e,t),!0):!1}const N=new WeakMap,ve=(...e)=>{var t;const n=e[0],i=(t=H())===null||t===void 0?void 0:t.proxy,l=i??Y();if(l==null&&!Q())throw new Error("injectLocal must be called in setup");return l&&N.has(l)&&n in N.get(l)?N.get(l)[n]:se(...e)},he=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const pe=e=>e!=null,me=Object.prototype.toString,we=e=>me.call(e)==="[object Object]",S=()=>{};function ge(e,t){function n(...i){return new Promise((l,f)=>{Promise.resolve(e(()=>t.apply(this,i),{fn:t,thisArg:this,args:i})).then(l).catch(f)})}return n}function ye(e,t={}){let n,i,l=S;const f=s=>{clearTimeout(s),l(),l=S};let d;return s=>{const r=y(e),a=y(t.maxWait);return n&&f(n),r<=0||a!==void 0&&a<=0?(i&&(f(i),i=void 0),Promise.resolve(s())):new Promise((u,p)=>{l=t.rejectOnCancel?p:u,d=s,a&&!i&&(i=setTimeout(()=>{n&&f(n),i=void 0,u(d())},a)),n=setTimeout(()=>{i&&f(i),i=void 0,u(s())},r)})}}function D(e){return e.endsWith("rem")?Number.parseFloat(e)*16:Number.parseFloat(e)}function C(e){return Array.isArray(e)?e:[e]}function be(e){return H()}function xe(e,t=200,n={}){return ge(ye(t,n),e)}function Me(e,t=!0,n){be()?L(e,n):t?e():oe(e)}function We(e,t,n){return k(e,t,{...n,immediate:!0})}const j=he?window:void 0;function E(e){var t;const n=y(e);return(t=n==null?void 0:n.$el)!==null&&t!==void 0?t:n}function F(...e){const t=[],n=()=>{t.forEach(o=>o()),t.length=0},i=(o,s,r,a)=>(o.addEventListener(s,r,a),()=>o.removeEventListener(s,r,a)),l=T(()=>{const o=C(y(e[0])).filter(s=>s!=null);return o.every(s=>typeof s!="string")?o:void 0}),f=We(()=>{var o,s;return[(o=(s=l.value)===null||s===void 0?void 0:s.map(r=>E(r)))!==null&&o!==void 0?o:[j].filter(r=>r!=null),C(y(l.value?e[1]:e[0])),C(re(l.value?e[2]:e[1])),y(l.value?e[3]:e[2])]},([o,s,r,a])=>{if(n(),!(o!=null&&o.length)||!(s!=null&&s.length)||!(r!=null&&r.length))return;const u=we(a)?{...a}:a;t.push(...o.flatMap(p=>s.flatMap(v=>r.map(x=>i(p,v,x,u)))))},{flush:"post"}),d=()=>{f(),n()};return Z(n),d}function Ie(){const e=b(!1),t=H();return t&&L(()=>{e.value=!0},t),e}function J(e){const t=Ie();return T(()=>(t.value,!!e()))}const Se=Symbol("vueuse-ssr-width");function _e(){const e=Q()?ve(Se,null):null;return typeof e=="number"?e:void 0}function Ce(e,t={}){const{window:n=j,ssrWidth:i=_e()}=t,l=J(()=>n&&"matchMedia"in n&&typeof n.matchMedia=="function"),f=b(typeof i=="number"),d=b(),o=b(!1),s=r=>{o.value=r.matches};return ie(()=>{if(f.value){f.value=!l.value,o.value=y(e).split(",").some(r=>{const a=r.includes("not all"),u=r.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),p=r.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let v=!!(u||p);return u&&v&&(v=i>=D(u[1])),p&&v&&(v=i<=D(p[1])),a?!v:v});return}l.value&&(d.value=n.matchMedia(y(e)),o.value=d.value.matches)}),F(d,"change",s,{passive:!0}),T(()=>o.value)}function Ee(e,t,n={}){const{root:i,rootMargin:l="0px",threshold:f=0,window:d=j,immediate:o=!0}=n,s=J(()=>d&&"IntersectionObserver"in d),r=T(()=>C(y(e)).map(E).filter(pe));let a=S;const u=b(o),p=s.value?k(()=>[r.value,E(i),u.value],([x,O])=>{if(a(),!u.value||!x.length)return;const _=new IntersectionObserver(t,{root:E(O),rootMargin:l,threshold:f});x.forEach(M=>M&&_.observe(M)),a=()=>{_.disconnect(),a=S}},{immediate:o,flush:"post"}):S,v=()=>{a(),p(),u.value=!1};return Z(v),{isSupported:s,isActive:u,pause(){a(),u.value=!1},resume(){u.value=!0},stop:v}}function ke(e={}){const{window:t=j,initialWidth:n=Number.POSITIVE_INFINITY,initialHeight:i=Number.POSITIVE_INFINITY,listenOrientation:l=!0,includeScrollbar:f=!0,type:d="inner"}=e,o=b(n),s=b(i),r=()=>{if(t)if(d==="outer")o.value=t.outerWidth,s.value=t.outerHeight;else if(d==="visual"&&t.visualViewport){const{width:u,height:p,scale:v}=t.visualViewport;o.value=Math.round(u*v),s.value=Math.round(p*v)}else f?(o.value=t.innerWidth,s.value=t.innerHeight):(o.value=t.document.documentElement.clientWidth,s.value=t.document.documentElement.clientHeight)};r(),Me(r);const a={passive:!0};return F("resize",r,a),t&&d==="visual"&&t.visualViewport&&F(t.visualViewport,"resize",r,a),l&&k(Ce("(orientation: portrait)"),()=>r()),{width:o,height:s}}const Te={class:"relative w-full h-full"},je=["src","onLoad","onError","onClick"],Oe={key:0,class:"absolute inset-0 flex items-center justify-center placeholder"},Pe={key:1,class:"absolute inset-0 flex items-center justify-center error"},$e={class:"max-w-[100vw] max-h-[100vh] overflow-auto"},ze={class:"min-w-full min-h-full flex items-center justify-center"},Ve=["src"],G=400,U=1e3,Ne=le({__name:"index",setup(e){const t=w([]),n=w(null),i=w(!1),l=w(G),f=w(G),d=w({}),o=w({}),s=c=>{d.value[c]=!0,o.value[c]=!1},r=c=>{o.value[c]=!0,d.value[c]=!1},a=w(null),u=w(1),p=c=>{a.value=c,u.value=1},v=()=>{a.value=null},x=c=>{const m=u.value+(c.deltaY>0?-.1:.1);u.value=Math.min(5,Math.max(.2,m))},O=()=>Date.now().toString(36)+Math.random().toString(36).slice(2),_=()=>`https://picsum.photos/${U}/${U}?hash=${O()}`,M=c=>{if(!i.value){i.value=!0;for(let h=0;h<c;h++)t.value.push(_());i.value=!1}},B=()=>{const c=Math.max(1,Math.floor(window.innerWidth/l.value)),h=Math.max(1,Math.ceil(window.innerHeight/f.value));return c*h};let P=null,$=null;const{width:K,height:X}=ke(),q=()=>{const c=B();return Math.max(0,c-t.value.length)},ee=xe(()=>{const c=q();c>0&&M(c)},200);return L(()=>{M(B());const{stop:c}=Ee(n,([h])=>{if(console.log(h),h&&h.isIntersecting){const m=Math.max(1,Math.floor(window.innerWidth/l.value));M(m)}});P=c,$=k([K,X],()=>{ee()})}),ae(()=>{P&&P(),$&&$()}),(c,h)=>(I(),W(A,null,[g("div",{class:"grid gap-4",style:V({gridTemplateColumns:`repeat(auto-fit, minmax(${l.value}px, 1fr))`})},[(I(!0),W(A,null,ue(t.value,(m,te)=>(I(),W("div",{key:te,class:"bg-[#f0f0f0] p-4 flex items-center justify-center",style:V({minWidth:l.value+"px",minHeight:f.value+"px"})},[g("div",Te,[g("img",{src:m,alt:"",class:de(["w-full h-full cursor-pointer object-cover transition-opacity duration-300",d.value[m]?"opacity-100":"opacity-0"]),onLoad:R=>s(m),onError:R=>r(m),onClick:R=>p(m)},null,42,je),!d.value[m]&&!o.value[m]?(I(),W("div",Oe,[...h[0]||(h[0]=[g("div",{class:"loader"},null,-1)])])):z("",!0),o.value[m]?(I(),W("div",Pe,[...h[1]||(h[1]=[g("span",{class:"error-text"},"图片加载失败",-1)])])):z("",!0)])],4))),128))],4),g("div",{ref_key:"infiniteSentinel",ref:n,class:"h-1"},null,512),a.value?(I(),W("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:v,onWheel:ce(x,["prevent"])},[g("div",$e,[g("div",ze,[g("img",{src:a.value,class:"block max-w-none cursor-zoom-out select-none",style:V({transform:`scale(${u.value})`,transformOrigin:"center"}),onClick:v},null,12,Ve)])])],32)):z("",!0)],64))}}),He=fe(Ne,[["__scopeId","data-v-2e012b18"]]);export{He as default};
