var R=Object.defineProperty;var B=(T,e,i)=>e in T?R(T,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):T[e]=i;var C=(T,e,i)=>B(T,typeof e!="symbol"?e+"":e,i);/* empty css                  *//* empty css               */import{d as V,r as M,o as I,R as $,c as h,a as _,b as s,g as n,w as r,S as w,T as q,e as u,q as S,t as v,U as H,E as U,V as G,W,X,Y,_ as j}from"./index-Ch7JS-cg.js";class z{constructor(){C(this,"metrics",{});C(this,"observers",[]);C(this,"startTime");C(this,"isFirstScreenCalculated",!1);this.startTime=performance.now(),this.initPerformanceObserver(),this.calculateBasicMetrics()}initPerformanceObserver(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(c=>{for(const a of c.getEntries())a.name==="first-contentful-paint"&&(this.metrics.firstContentfulPaint=Math.round(a.startTime),this.metrics.whiteScreenTime=Math.round(a.startTime))});e.observe({entryTypes:["paint"]}),this.observers.push(e);const i=new PerformanceObserver(c=>{const a=c.getEntries(),d=a[a.length-1];this.metrics.largestContentfulPaint=Math.round(d.startTime),this.isFirstScreenCalculated||(this.metrics.firstScreenTime=Math.round(d.startTime),this.isFirstScreenCalculated=!0)});i.observe({entryTypes:["largest-contentful-paint"]}),this.observers.push(i)}catch(e){console.warn("PerformanceObserver not supported:",e),this.fallbackCalculation()}else this.fallbackCalculation()}calculateBasicMetrics(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{this.metrics.domContentLoadedTime=Math.round(performance.now())}):this.metrics.domContentLoadedTime=Math.round(performance.now()),document.readyState!=="complete"?window.addEventListener("load",()=>{this.metrics.loadTime=Math.round(performance.now()),this.isFirstScreenCalculated||(this.metrics.firstScreenTime=this.metrics.loadTime,this.isFirstScreenCalculated=!0)}):(this.metrics.loadTime=Math.round(performance.now()),this.isFirstScreenCalculated||(this.metrics.firstScreenTime=this.metrics.loadTime,this.isFirstScreenCalculated=!0))}fallbackCalculation(){setTimeout(()=>{const e=performance.timing,i=e.navigationStart,c=e.responseEnd-i;this.metrics.whiteScreenTime=c;const a=e.domContentLoadedEventEnd-i;this.metrics.firstScreenTime=a,this.isFirstScreenCalculated=!0},0)}calculateFirstScreenTimeByViewport(){return new Promise(e=>{const i=()=>{var g;const c=window.innerHeight,a=document.querySelectorAll("*");let d=!1;for(const l of a){const p=l.getBoundingClientRect();if(p.top<c&&p.bottom>0&&p.width>0&&p.height>0){const o=window.getComputedStyle(l);if(o.opacity!=="0"&&o.visibility!=="hidden"&&o.display!=="none"&&(((g=l.textContent)==null?void 0:g.trim())||o.backgroundImage!=="none"||l.tagName==="IMG"||l.tagName==="VIDEO"||l.tagName==="CANVAS")){d=!0;break}}}if(d){const l=Math.round(performance.now());this.metrics.firstScreenTime=l,this.isFirstScreenCalculated=!0,e(l)}else requestAnimationFrame(i)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()})}getMetrics(){return{...this.metrics}}getFormattedReport(){const e=this.getMetrics();return`
性能监控报告:
- 白屏时间: ${e.whiteScreenTime||"N/A"}ms
- 首屏时间: ${e.firstScreenTime||"N/A"}ms
- DOM解析完成: ${e.domContentLoadedTime||"N/A"}ms
- 页面完全加载: ${e.loadTime||"N/A"}ms
- 首次内容绘制(FCP): ${e.firstContentfulPaint||"N/A"}ms
- 最大内容绘制(LCP): ${e.largestContentfulPaint||"N/A"}ms
    `.trim()}destroy(){this.observers.forEach(e=>e.disconnect()),this.observers=[]}async waitForMetrics(e=1e4){return new Promise((i,c)=>{const a=Date.now(),d=()=>{const g=this.getMetrics();g.whiteScreenTime!==void 0&&g.firstScreenTime!==void 0?i(g):Date.now()-a>e?c(new Error("Performance metrics calculation timeout")):setTimeout(d,100)};d()})}}const f=new z;window.addEventListener("beforeunload",()=>{f.destroy()});const J={class:"performance-demo"},K={class:"performance-section"},Q={key:0,class:"loading"},Z={key:1,class:"metrics-grid"},ee={class:"card-header"},te={class:"metric-value"},se={key:0,class:"unit"},ne={class:"card-header"},re={class:"metric-value"},ie={key:0,class:"unit"},oe={class:"card-header"},ae={class:"metric-value"},ce={key:0,class:"unit"},le={class:"card-header"},de={class:"metric-value"},me={key:0,class:"unit"},ue={class:"card-header"},fe={class:"metric-value"},ve={key:0,class:"unit"},pe={class:"card-header"},he={class:"metric-value"},_e={key:0,class:"unit"},ge={class:"actions"},we={class:"card-header"},Te={class:"performance-report"},ye={class:"performance-rating"},Se={class:"rating-item"},Ce={class:"rating-item"},Me=V({__name:"index",setup(T){const e=M({}),i=M(!0),c=M(""),a=M(!1),d=async()=>{try{i.value=!0;const o=await f.waitForMetrics(5e3);e.value=o,c.value=f.getFormattedReport(),console.log("性能监控数据:",o),console.log("性能报告:",c.value)}catch(o){console.error("获取性能指标失败:",o),e.value=f.getMetrics(),c.value=f.getFormattedReport()}finally{i.value=!1}},g=async()=>{try{const o=await f.calculateFirstScreenTimeByViewport();e.value=f.getMetrics(),c.value=f.getFormattedReport(),console.log("重新计算的首屏时间:",o)}catch(o){console.error("重新计算首屏时间失败:",o)}},l=()=>{e.value=f.getMetrics(),c.value=f.getFormattedReport()},p=(o,t)=>{if(!o)return{type:"info",text:"未知"};const m={whiteScreen:{good:1e3,fair:2e3},firstScreen:{good:2e3,fair:4e3}}[t];return o<=m.good?{type:"success",text:"优秀"}:o<=m.fair?{type:"warning",text:"良好"}:{type:"danger",text:"需要优化"}};return I(()=>{d();const o=setInterval(l,1e3);setTimeout(()=>{clearInterval(o)},5e3)}),$(()=>{f.destroy()}),(o,t)=>{const b=w("Loading"),m=q,k=w("Timer"),y=H,E=w("Monitor"),N=w("Document"),A=w("Check"),L=w("Picture"),x=w("PictureRounded"),P=U,D=w("DataAnalysis"),O=X,F=Y;return _(),h("div",J,[s("div",K,[t[20]||(t[20]=s("h2",null,"页面性能监控",-1)),i.value?(_(),h("div",Q,[n(m,{class:"is-loading"},{default:r(()=>[n(b)]),_:1}),t[1]||(t[1]=s("span",null,"正在计算性能指标...",-1))])):(_(),h("div",Z,[n(y,{class:"metric-card white-screen",shadow:"hover"},{header:r(()=>[s("div",ee,[n(m,null,{default:r(()=>[n(k)]),_:1}),t[2]||(t[2]=s("span",null,"白屏时间",-1))])]),default:r(()=>[s("div",te,[u(v(e.value.whiteScreenTime||"N/A")+" ",1),e.value.whiteScreenTime?(_(),h("span",se,"ms")):S("",!0)]),t[3]||(t[3]=s("div",{class:"metric-desc"},"从页面开始加载到首次内容绘制的时间",-1))]),_:1}),n(y,{class:"metric-card first-screen",shadow:"hover"},{header:r(()=>[s("div",ne,[n(m,null,{default:r(()=>[n(E)]),_:1}),t[4]||(t[4]=s("span",null,"首屏时间",-1))])]),default:r(()=>[s("div",re,[u(v(e.value.firstScreenTime||"N/A")+" ",1),e.value.firstScreenTime?(_(),h("span",ie,"ms")):S("",!0)]),t[5]||(t[5]=s("div",{class:"metric-desc"},"首屏内容完全加载显示的时间",-1))]),_:1}),n(y,{class:"metric-card dom-ready",shadow:"hover"},{header:r(()=>[s("div",oe,[n(m,null,{default:r(()=>[n(N)]),_:1}),t[6]||(t[6]=s("span",null,"DOM解析",-1))])]),default:r(()=>[s("div",ae,[u(v(e.value.domContentLoadedTime||"N/A")+" ",1),e.value.domContentLoadedTime?(_(),h("span",ce,"ms")):S("",!0)]),t[7]||(t[7]=s("div",{class:"metric-desc"},"DOM解析完成时间",-1))]),_:1}),n(y,{class:"metric-card load-complete",shadow:"hover"},{header:r(()=>[s("div",le,[n(m,null,{default:r(()=>[n(A)]),_:1}),t[8]||(t[8]=s("span",null,"完全加载",-1))])]),default:r(()=>[s("div",de,[u(v(e.value.loadTime||"N/A")+" ",1),e.value.loadTime?(_(),h("span",me,"ms")):S("",!0)]),t[9]||(t[9]=s("div",{class:"metric-desc"},"页面完全加载时间",-1))]),_:1}),n(y,{class:"metric-card fcp",shadow:"hover"},{header:r(()=>[s("div",ue,[n(m,null,{default:r(()=>[n(L)]),_:1}),t[10]||(t[10]=s("span",null,"FCP",-1))])]),default:r(()=>[s("div",fe,[u(v(e.value.firstContentfulPaint||"N/A")+" ",1),e.value.firstContentfulPaint?(_(),h("span",ve,"ms")):S("",!0)]),t[11]||(t[11]=s("div",{class:"metric-desc"},"首次内容绘制时间",-1))]),_:1}),n(y,{class:"metric-card lcp",shadow:"hover"},{header:r(()=>[s("div",pe,[n(m,null,{default:r(()=>[n(x)]),_:1}),t[12]||(t[12]=s("span",null,"LCP",-1))])]),default:r(()=>[s("div",he,[u(v(e.value.largestContentfulPaint||"N/A")+" ",1),e.value.largestContentfulPaint?(_(),h("span",_e,"ms")):S("",!0)]),t[13]||(t[13]=s("div",{class:"metric-desc"},"最大内容绘制时间",-1))]),_:1})])),s("div",ge,[n(P,{type:"primary",onClick:d,loading:i.value},{default:r(()=>[...t[14]||(t[14]=[u(" 刷新性能数据 ",-1)])]),_:1},8,["loading"]),n(P,{type:"success",onClick:g},{default:r(()=>[...t[15]||(t[15]=[u(" 重新计算首屏时间 ",-1)])]),_:1}),n(P,{type:"info",onClick:t[0]||(t[0]=Pe=>a.value=!a.value)},{default:r(()=>[u(v(a.value?"隐藏":"显示")+"详细报告 ",1)]),_:1})]),n(O,null,{default:r(()=>[G(n(y,{class:"report-card",shadow:"never"},{header:r(()=>[s("div",we,[n(m,null,{default:r(()=>[n(D)]),_:1}),t[16]||(t[16]=s("span",null,"详细性能报告",-1))])]),default:r(()=>[s("pre",Te,v(c.value),1)]),_:1},512),[[W,a.value]])]),_:1}),s("div",ye,[t[19]||(t[19]=s("h3",null,"性能评级",-1)),s("div",Se,[t[17]||(t[17]=s("span",null,"白屏时间评级：",-1)),n(F,{type:p(e.value.whiteScreenTime,"whiteScreen").type},{default:r(()=>[u(v(p(e.value.whiteScreenTime,"whiteScreen").text),1)]),_:1},8,["type"])]),s("div",Ce,[t[18]||(t[18]=s("span",null,"首屏时间评级：",-1)),n(F,{type:p(e.value.firstScreenTime,"firstScreen").type},{default:r(()=>[u(v(p(e.value.firstScreenTime,"firstScreen").text),1)]),_:1},8,["type"])])])])])}}}),Ne=j(Me,[["__scopeId","data-v-e8aa7ddf"]]);export{Ne as default};
